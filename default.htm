<html>
  <header>
    <!--<tit>test webSocket</tit>-->
    <script src="./x/xterm.js" type="module"></script>
    <script src="./x/a-attach-x.js" type="module"></script>
    <script src="./x/a-fit-x.js" type="module"></script>
    <link href="./x/xterm.css" rel="stylesheet" />
  </header>
  <body>
    <div
      class="c-header"
      style="">
      </div>
    <div
      class="c-nav"
      style="">
      </div>
    <div
      class="c-main"
      style="">
      <!--<div class="pre" id="t1"></div>-->
      <div class="pre" style="font-size:17px;line-height:132%;border-width:7px 21px 7px 21px;border-style:double solid double solid;border-color:#ff0000 #0000ff #ff0000 #0000ff;background-color:#000;color:#ffff;white-space:pre-wrap;word-wrap:break-word" _="" id="consoleShow"></div>
      <!--<div class="pre" id="t2"></div>-->
      <style><!--
      body {
        width: 100%;
        margin: 0 auto;
        /* min-width: 1002px; */
        background-color: #ffffff;
        height: 100%;
        /* min-height: 521px; */
        padding: 0
      }
      /*scroll-custom-webkit {
        -webkit-scrollbar: ; -webkit-scrollbar-button: ; -webkit-scrollbar-thumb: ; -webkit-scrollbar-track: ; -webkit-scrollbar-track-piece: ; -webkit-scrollbar-corner: ; -webkit-resizer: ;
      }*/
      .c-header {
        height: calc(23% - 47px - 6px)
      }
      .c-nav {
        margin: 3px auto;
        background-color: #cccccc;
        height: 47px
      }
      .c-main {
        margin: 0px auto;
        width: calc(100% - 19%);
        height: 60%
      }
      .pre {
        margin: 0px 1px;
        height: calc(100% - 14px);
        overflow-y: scroll
      }
      .c-fgx {
        margin: 3px auto;
        background-color: #ccc;
        height: 7px
      }
      .c-footer {
        height: calc(17% - 7px - 6px)
      }
      #consoleShow::-webkit-scrollbar {
        width: 0px
      }
      div {
        width: 100%;
        margin: 0;
        /* display: flex;
        justify-content: center;
        align-items: center; */
        height: 100%;
        padding: 0
      }
      --></style>
      <script type="module" _="">
        let mapObject = {}
        let pre = document.getElementsByClassName("pre") //
        let reSize = function(key) {
          mapObject[key].f.fit()
        }
        for (let i=0;i < pre.length;i ++) {
          let xterm = new Terminal(), /*attachAddon = new AttachAddon.AttachAddon(wss),*/ fitAddon = new FitAddon.FitAddon()
              xterm.loadAddon(fitAddon); /*xterm.loadAddon(attachAddon);*/ xterm.open( pre[i] )
          /* ; */ mapObject[pre[i].id] = { x: xterm,f: fitAddon/*,a: attachAddon*/ }; reSize( pre[i].id )
        }
        let wss = new WebSocket("ws://"+self.location.host+"/?id={{.tstmp}}")
        wss.onmessage = function(e) {
          let log = eval('('+e.data+')')
          for (let key in mapObject) { if (log[key]==undefined) {continue};let textContent = log[key].match(/\n$/)!=null ? log[key] : log[key]+"\r\n";mapObject[key].x.write(textContent);/* ; *//*pre[key].scrollTop=pre[key].scrollHeight*/ }
          /*console.log(log)*/
        }
        ///console.log(wss.readyState)
        // for (let i=0;i < pre.length;i ++) {
        //   $(".pre").eq(i).bind("resize", function(e) { console.log(e) })
        // }
        window.addEventListener('resize', () => { //onresize = (event) => {}
          for (let i=0;i < pre.length;i ++) {
            reSize( pre[i].id )
          }
        })
      </script>
    </div>
    <div
      class="c-fgx"
      style="">
      </div>
    <div
      class="c-footer"
      style="">
      </div>
  </body>
</html>